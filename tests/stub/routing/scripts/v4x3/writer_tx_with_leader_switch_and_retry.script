!: BOLT #VERSION#
!: AUTO HELLO
!: AUTO GOODBYE
!: AUTO RESET
!: ALLOW RESTART

C: BEGIN {"db": "adb"}
S: SUCCESS {}
{{
    C: RUN "RETURN 1.1 as n" {} {}
       PULL {"n": 1000}
    S: FAILURE {"code": "Neo.ClientError.Cluster.NotALeader", "message": "blabla"}
       IGNORED
    {?
        # Drivers that keep the connection alive after NotALeader will take this
        # path.
        C: BEGIN {"db": "adb"}
        S: SUCCESS {}
        C: RUN "RETURN 2.1 as n" {} {}
           PULL {"n": 1000}
        S: SUCCESS {"fields": ["n"]}
           RECORD [1]
           SUCCESS {"type": "w"}
        C: RUN "RETURN 2.2 as n" {} {}
           PULL {"n": 1000}
        S: SUCCESS {"fields": ["n"]}
           RECORD [1]
           SUCCESS {"type": "w"}
        C: COMMIT
        S: SUCCESS {}
    ?}
----
    # Drivers that close the connection after NotALeader will take this path
    # after a reconnect.
    C: RUN "RETURN 2.1 as n" {} {}
       PULL {"n": 1000}
    S: SUCCESS {"fields": ["n"]}
       RECORD [1]
       SUCCESS {"type": "w"}
    C: RUN "RETURN 2.2 as n" {} {}
       PULL {"n": 1000}
    S: SUCCESS {"fields": ["n"]}
       RECORD [1]
       SUCCESS {"type": "w"}
    C: COMMIT
    S: SUCCESS {}
}}
